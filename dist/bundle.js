(()=>{"use strict";var e={136:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});class a{static paint(e,t){const n=a.calculateScreenCutOffPoints(e.width,t.canvas.width),s=a.calculateScreenCutOffPoints(e.height,t.canvas.height),i=t.mainCharacter.getX()<t.canvas.width?0:n[Math.floor(e.width/t.mainCharacter.getX())-1],o=t.mainCharacter.getY()<t.canvas.height?0:s[Math.floor(e.height/t.mainCharacter.getY())-1];t.context.drawImage(e,i,o,t.canvas.width,t.canvas.height,0,0,t.canvas.width,t.canvas.height),t.mainCharacter.setBgStart(i,o),t.level.setBgOffset(i,o)}static calculateScreenCutOffPoints(e,t){const a=[],n=Math.floor(e/t);for(let e=1;e<n;e++)a.push(e*t);return a.push(e-n*t),a}static readjustCanvasForBg(e,t){t.height<e.height&&(e.height=t.height),t.width<e.width&&(e.width=t.width)}}t.default=a},808:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.getX=()=>this.x,this.getY=()=>this.y,this.getIsMain=()=>this.isMain,this.getIsFood=()=>this.isFood,this.getIsObstacle=()=>this.isObstacle}loadImage(){return new Promise(((e,t)=>{const a=document.createElement("img");a.src=this.imagePath,a.onload=()=>{this.image=a,e(a)},a.onerror=()=>t(new Error("Failed to load turtle image"))}))}paint(e){throw new Error("Method not implemented.")}setPosition(e,t){this.x=e,this.y=t}}},482:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=a(808);class s extends n.default{constructor(){super(...arguments),this.isMain=!1,this.isFood=!0,this.isObstacle=!1,this.imagePath="./images/shrimp.png",this.foodValue=.01,this.getFoodValue=()=>this.foodValue}paint(e,t=0,a=0){e.drawImage(this.image,this.x-t,this.y-a,this.image.width,this.image.height)}}t.default=s},386:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=a(307),s=a(808);class i extends s.default{constructor(){super(),this.isMain=!0,this.isFood=!1,this.isObstacle=!1,this.imagePath="./images/turtle.png",this.getFoodValue=()=>this.foodValue,this.getLifeValue=()=>this.lifeValue,this.resetPosition(),this.angle=n.default.right,this.setBgStart(0,0),this.resetFoodValue(),this.resetLifeValue()}resetPosition(){this.x=50,this.y=10}resetFoodValue(){this.foodValue=100}resetLifeValue(){this.lifeValue=100}increaseFoodValue(e){this.foodValue+=e}decreaseFoodValue(){this.foodValue-=.01}applyDamage(e){this.lifeValue-=e}setBgStart(e,t){this.bgStartX=e,this.bgStartY=t}setYLimit(e){this.limitY=e}moveUp(){this.rotate(n.default.up),this.y>0&&(this.y-=i.step)}moveDown(){this.rotate(n.default.down),this.y<this.limitY&&(this.y+=i.step)}moveLeft(){this.rotate(n.default.left),this.x>0&&(this.x-=i.step)}moveRight(){this.rotate(n.default.right),this.x+=i.step}rotate(e){this.angle=e}applyRotation(e){e.translate(this.x,this.y),e.rotate(this.angle),e.translate(-this.x,-this.y)}paint(e){this.applyRotation(e),console.log(`bg start: ${this.bgStartX}, ${this.bgStartY}`),e.drawImage(this.image,this.x-this.bgStartX,this.y-this.bgStartY,this.image.width/4,this.image.height/4),e.resetTransform()}}i.scientificName="Carretta carretta",i.step=3,t.default=i},307:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});const a={up:0,right:Math.PI/2,down:Math.PI,left:Math.PI+Math.PI/2};t.default=a},417:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=a(691),s=a(903),i=a(525);t.default=function(e){const{canvas:t,mainCharacter:a,upBtnId:o,leftBtnId:l,rightBtnId:d,downBtnId:r}=e;(0,n.default)(t,a),(0,i.default)(t,a),(0,s.default)(a,{upBtnId:o,leftBtnId:l,rightBtnId:d,downBtnId:r})}},691:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){e.addEventListener("keydown",(e=>function(e,t){["w","W","ArrowUp"].includes(e.key)&&t.moveUp(),["s","S","ArrowDown"].includes(e.key)&&t.moveDown(),["a","A","ArrowLeft"].includes(e.key)&&t.moveLeft(),["d","D","ArrowRight"].includes(e.key)&&t.moveRight()}(e,t)))}},903:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});let a=0;function n(e,t){t(),a=requestAnimationFrame((()=>n(e,t)))}function s(){cancelAnimationFrame(a)}function i(e,t,a){t.addEventListener("mousedown",(()=>n(e,a))),t.addEventListener("mouseup",s),t.addEventListener("mouseleave",s),t.addEventListener("touchstart",(()=>n(e,a))),t.addEventListener("touchend",s)}t.default=function(e,t){const a=document.getElementById(t.upBtnId),n=document.getElementById(t.leftBtnId),s=document.getElementById(t.rightBtnId),o=document.getElementById(t.downBtnId);i(e,a,(()=>e.moveUp())),i(e,n,(()=>e.moveLeft())),i(e,s,(()=>e.moveRight())),i(e,o,(()=>e.moveDown()))}},525:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){e.addEventListener("wheel",(e=>function(e,t){e.preventDefault(),e.deltaX<0&&t.moveLeft(),e.deltaX>0&&t.moveRight(),e.deltaY<0&&t.moveUp(),e.deltaY>0&&t.moveDown()}(e,t)))}},212:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=a(487);class s{static modal(e,t){if(!document.getElementById(t.id)){const a=document.createElement("div");if(a.tabIndex=1,a.id=t.id,a.classList.add("dialog","fixed","text-white","w-4/5","opacity-80","focus:opacity-95","bg-amber-500","dark:bg-gray-900","pt-5","pb-5","rounded-3xl","max-w-xl"),t.title){const e=document.createElement("h1");e.innerText=t.title,e.classList.add("text-center","text-xl"),a.appendChild(e),a.appendChild(document.createElement("hr"))}const s=document.createElement("div");switch(this.appendText(t.text,s),a.appendChild(s),e){case n.DialogType.Confirmation:{const e=t,n=document.createElement("div");n.classList.add("w-fit","m-auto"),a.appendChild(n),this.appendBtn(n,"Yes",(()=>{e.yesCallback(),this.closeModal(a)}),!1,"button"),this.appendBtn(n,"No",(()=>{e.noCallback(),this.closeModal(a)}),!0,"button");break}case n.DialogType.Notification:this.appendOKButton(a),this.listenKeyboard(a);break;case n.DialogType.Prompt:{const e=t;this.appendForm(a,e);break}case n.DialogType.Credits:{const e=t;this.appendCredits(s,e),this.appendOKButton(a),this.listenKeyboard(a);break}case n.DialogType.Menu:{const e=t;this.appendMenu(a,e),this.appendOKButton(a),this.listenKeyboard(a);break}case n.DialogType.Changelog:{const e=t;this.appendChangelog(a,e),this.appendOKButton(a),this.listenKeyboard(a);break}}document.body.appendChild(a)}}static appendBtn(e,t,a,n,s){const i=document.createElement("button");i.type=s,i.classList.add("rounded-3xl","m-1","cursor-pointer"),this.assignButtonColor(i,n);const o=document.createElement("span");o.classList.add("text-xl","ml-2","mr-2"),o.innerText=t,i.appendChild(o),"button"===s&&i.addEventListener("click",a),e.appendChild(i)}static appendForm(e,t){const a=document.createElement("div");a.classList.add("m-auto","w-3/4"),e.appendChild(a);const n=document.createElement("form");a.appendChild(n),n.addEventListener("submit",(a=>{a.preventDefault(),t.onOK&&t.onOK(),this.closeModal(e)})),this.appendInputs(n,t.inputs),this.appendSelects(n,t.selects);const s=document.createElement("div");s.classList.add("w-fit","m-auto"),n.appendChild(s),this.appendBtn(s,"OK",null,!1,"submit"),this.appendBtn(s,"Cancel",(()=>{t.onCancel&&t.onCancel(),this.closeModal(e)}),!0,"button")}static appendInputs(e,t){for(const a of t){const t=document.createElement("input");t.type=a.type,t.id=`dialog-input-${a.name}`,t.name=`dialog-input-${a.name}`,t.ariaPlaceholder=`Enter ${a.label}`,t.placeholder=`Enter ${a.label}`,t.maxLength=a.limit,this.assignInputClassNames(t),t.required=a.required,t.ariaRequired=a.required.toString(),e.appendChild(t),this.appendBrElement(e),this.appendBrElement(e)}}static assignInputClassNames(e){e.classList.add("text-center","w-full","rounded-3xl","h-9","text-lg","text-gray-700")}static appendSelects(e,t){for(const a of t){const t=document.createElement("select");t.id=`dialog-select-${a.name}`,t.name=`dialog-select-${a.name}`,t.ariaPlaceholder=a.label,this.assignInputClassNames(t),t.required=a.required,t.ariaRequired=a.required.toString(),e.appendChild(t);for(const e of a.options){const n=document.createElement("option");n.innerText=e.text,n.value=e.value,a.default===parseInt(e.value)&&(n.selected=!0,n.ariaSelected="true"),t.appendChild(n)}const n=a.onChange;n&&(n(t.selectedOptions[0].value),t.addEventListener("change",(()=>n(t.selectedOptions[0].value)))),this.appendBrElement(e),this.appendBrElement(e)}}static appendBrElement(e){const t=document.createElement("br");e.appendChild(t)}static appendText(e,t){if(this.assignTextClassNames(t),e)for(const a of e){const e=document.createElement("p");e.innerText=a,t.appendChild(e)}}static appendCredits(e,t){for(const a of t.sections){const t=document.createElement("h2");t.classList.add("text-xl"),t.innerText=a.title,e.appendChild(t);const n=document.createElement("ul");n.classList.add("ml-5");for(const e of a.contributors){const t=document.createElement("li");t.innerText=e,n.appendChild(t)}e.appendChild(n)}}static appendOKButton(e){const t=document.createElement("div");t.classList.add("w-fit","m-auto"),e.appendChild(t),this.appendBtn(t,"OK",(()=>this.closeModal(e)),!1,"button")}static listenKeyboard(e){e.addEventListener("keydown",(t=>{"Escape"!==t.key&&"Enter"!==t.key||this.closeModal(e)}))}static appendMenu(e,t){const a=document.createElement("div");a.classList.add("w-1/3","m-auto"),e.appendChild(a);for(const e of t.buttons){const t=document.createElement("button");t.type="button",t.innerText=e.text,t.classList.add("w-full","h-12","rounded-3xl","mt-3","mb-3"),this.assignButtonColor(t,e.isDanger),t.addEventListener("click",e.callback),a.appendChild(t)}}static appendChangelog(e,t){const a=document.createElement("div");this.assignTextClassNames(a),e.appendChild(a);for(const e of t.releases){const t=document.createElement("h2");t.classList.add("text-xl"),t.innerText=`${e.version} (${e.status} release - ${e.dateTime})`,a.appendChild(t);const n=document.createElement("ul");n.classList.add("ml-5"),a.appendChild(n);for(const t of e.points){const e=document.createElement("li");if(e.innerText=t.text,n.appendChild(e),t.subPoints&&t.subPoints.length>0){const a=document.createElement("ol");a.classList.add("list-decimal","ml-5"),e.appendChild(a);for(const e of t.subPoints){const t=document.createElement("li");t.innerText=e,a.appendChild(t)}}}}}static assignTextClassNames(e){e.classList.add("w-11/12","m-auto","mt-3","mb-3","grid","gap-3","max-h-screen-1/4","overflow-y-auto")}static assignButtonColor(e,t){t?e.classList.add("bg-red-600"):e.classList.add("bg-theme-color","dark:bg-dark-theme-color")}static closeModal(e){document.body.contains(e)&&document.body.removeChild(e)}static closeAllOpenDialogs(){const e=document.getElementsByClassName("dialog");for(let t=0;t<e.length;t++)this.closeModal(e[t])}}s.confirm=e=>s.modal(n.DialogType.Confirmation,e),s.notify=e=>s.modal(n.DialogType.Notification,e),s.prompt=e=>s.modal(n.DialogType.Prompt,e),s.credit=e=>s.modal(n.DialogType.Credits,e),s.menu=e=>s.modal(n.DialogType.Menu,e),s.changelog=e=>s.modal(n.DialogType.Changelog,e),t.default=s},487:(e,t)=>{var a;Object.defineProperty(t,"__esModule",{value:!0}),t.DialogType=void 0,function(e){e[e.Confirmation=0]="Confirmation",e[e.Notification=1]="Notification",e[e.Prompt=2]="Prompt",e[e.Credits=3]="Credits",e[e.Menu=4]="Menu",e[e.Changelog=5]="Changelog"}(a||(t.DialogType=a={}))},11:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=a(10);t.default=function(e){if(e<=n.default.length)return n.default[e-1];throw new Error(`Level ${e} not implemented`)}},721:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this.getBgImgPath=()=>this.backgroundImagePath,this.getBgImg=()=>this.backgroundImage,this.getCharacters=()=>this.characters}loadBgImg(){return new Promise(((e,t)=>{const a=document.createElement("img");a.src=this.backgroundImagePath,a.onload=()=>{this.backgroundImage=a,e(a)},a.onerror=()=>t(new Error("Could not load level background"))}))}setBgOffset(e,t){this.bgOffsetX=e,this.bgOffsetY=t}setInitialCharacterPositions(){for(const e of this.characters){const t=Math.random()*this.backgroundImage.width,a=Math.random()*this.backgroundImage.height;e.setPosition(t,a)}}async loadCharacters(){for(const e of this.characters)await e.loadImage()}paintCharacters(e){for(const t of this.characters)t.paint(e,this.bgOffsetX,this.bgOffsetY)}}},630:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=a(482),s=a(721);class i extends s.default{constructor(){super(...arguments),this.backgroundImagePath="./images/bg-lvl1.png",this.characters=new Set([new n.default,new n.default,new n.default,new n.default,new n.default,new n.default,new n.default])}}t.default=i},809:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=a(721);class s extends n.default{constructor(){super(...arguments),this.backgroundImagePath="./images/bg-demo-black.png",this.characters=new Set([])}}t.default=s},10:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LevelChangeTypes=void 0;const n=a(630),s=a(809);var i;!function(e){e[e.GameOver=0]="GameOver",e[e.NewLevel=1]="NewLevel",e[e.SameLevel=2]="SameLevel",e[e.GameComplete=3]="GameComplete"}(i||(t.LevelChangeTypes=i={}));const o=[new n.default,new s.default];t.default=o},962:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=a(212),s=a(10);t.default=function(e,t){return e.decreaseFoodValue(),e.getFoodValue()<=0?{levelChangeType:s.LevelChangeTypes.GameOver}:e.getX()>=t.bgWidth?function(e,t){return t.currentLvl++,e.resetPosition(),t.currentLvl<=s.default.length?(n.default.notify({id:"new-level",title:"New Level",text:[`Welcome to level ${t.currentLvl}`]}),{levelChangeType:s.LevelChangeTypes.NewLevel,newLevel:t.currentLvl}):{levelChangeType:s.LevelChangeTypes.GameComplete}}(e,t):{levelChangeType:s.LevelChangeTypes.SameLevel}}},147:e=>{e.exports=JSON.parse('{"version":"0.1.0 Preview","devDependencies":{"concurrently":"^8.2.2","postcss":"^8.4.33","serve":"^14.2.1","tailwindcss":"^3.4.1","ts-loader":"^9.5.1","typescript":"^5.3.3","webpack":"^5.89.0","webpack-cli":"^5.1.4"},"scripts":{"webpack":"npx webpack --watch","serve":"npx serve -l 5000","tailwind":"npx tailwindcss -i ./src/main.css -o ./dist/bundle.css --watch --minify","dev":"npx concurrently \\"npm run webpack\\" \\"npm run serve\\" \\"npm run tailwind\\"","start":"npm run dev"}}')}},t={};function a(n){var s=t[n];if(void 0!==s)return s.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,a),i.exports}(()=>{const e=a(386),t=a(147),n=a(417),s=a(962),i=a(11),o=a(212),l=a(136),d=a(630),r=a(10);(async()=>{const a=document.getElementById("canvas"),c=a.getContext("2d"),u=new e.default;await u.loadImage();let h=1;(0,n.default)({canvas:a,mainCharacter:u,upBtnId:"upBtn",leftBtnId:"leftBtn",rightBtnId:"rightBtn",downBtnId:"downBtn"});let p=new d.default,m=await g();async function g(){const e=await p.loadBgImg();return p.setInitialCharacterPositions(),await p.loadCharacters(),u.setYLimit(e.height),e}function f(){a.height=window.innerHeight,a.width=window.innerWidth,l.default.readjustCanvasForBg(a,m)}l.default.readjustCanvasForBg(a,m),window.addEventListener("resize",f),f(),document.getElementById("version").innerText=t.version,a.focus(),async function e(){try{const{levelChangeType:t,newLevel:n}=(0,s.default)(u,{bgWidth:m.width,currentLvl:h});t===r.LevelChangeTypes.SameLevel||t===r.LevelChangeTypes.NewLevel?(t===r.LevelChangeTypes.NewLevel&&(h=n,p=(0,i.default)(h),m=await g()),l.default.paint(m,{canvas:a,context:c,mainCharacter:u,level:p}),u.paint(c),p.paintCharacters(c),document.getElementById("foodMeter").value=u.getFoodValue(),document.getElementById("lifeMeter").value=u.getLifeValue(),requestAnimationFrame(e)):t===r.LevelChangeTypes.GameComplete?o.default.notify({id:"game-over-dialog",title:"Game complete",text:["Game complete. Congratulations!"]}):o.default.notify({id:"game-over-dialog",title:"You lose",text:["Better luck next time!"]})}catch(e){o.default.notify({id:"game-error",title:"Error",text:[e]})}}(),o.default.notify({id:"dialog-game-welcome",title:"Welcome",text:["Welcome to Turtle Escape!"]}),await screen.orientation.lock("landscape-primary")})()})()})();
//# sourceMappingURL=bundle.js.map