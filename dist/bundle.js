(()=>{"use strict";var e={136:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});class a{static paint(e,t){const n=a.calculateScreenCutOffPoints(e.width,t.canvas.width),i=a.calculateScreenCutOffPoints(e.height,t.canvas.height),s=t.mainCharacter.x<t.canvas.width?0:n[Math.floor(e.width/t.mainCharacter.x)-1],o=t.mainCharacter.y<t.canvas.height?0:i[Math.floor(e.height/t.mainCharacter.y)-1];t.context.drawImage(e,s,o,t.canvas.width,t.canvas.height,0,0,t.canvas.width,t.canvas.height),a.updateBgRelatedProperties(t,s,o)}static calculateScreenCutOffPoints(e,t){const a=[],n=Math.floor(e/t);for(let e=1;e<n;e++)a.push(e*t);return a.push(e-n*t),a}static readjustCanvasForBg(e,t){t.height<e.height&&(e.height=t.height),t.width<e.width&&(e.width=t.width)}static updateBgRelatedProperties(e,t,a){e.mainCharacter.bgStartX=t,e.mainCharacter.bgStartY=a,e.level.bgOffsetX=t,e.level.bgOffsetY=a}}t.default=a},808:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this._baseImagePath="./images/"}loadImage(){return new Promise(((e,t)=>{const a=document.createElement("img");a.src=this._baseImagePath+this._imageFilename,a.onload=()=>{this._image=a,e(a)},a.onerror=()=>t(new Error(`Failed to load character image: ${this._imageFilename}`))}))}get x(){return this._x}get y(){return this._y}set x(e){this._x=e}set y(e){this._y=e}get isMain(){return this._isMain}get isPrey(){return this._isPrey}get isObstacle(){return this._isObstacle}get foodValue(){return this._foodValue}get image(){return this._image}}},482:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=a(808);class i extends n.default{constructor(){super(...arguments),this._isMain=!1,this._isPrey=!0,this._isObstacle=!1,this._imageFilename="shrimp.png",this._foodValue=.01}paint(e,t=0,a=0){e.drawImage(this.image,this.x-t,this.y-a,this.image.width,this.image.height)}}t.default=i},873:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=a(808);class i extends n.default{constructor(){super(...arguments),this._isMain=!1,this._isPrey=!0,this._isObstacle=!1,this._imageFilename="small-fish.png",this._foodValue=.6}paint(e,t=0,a=0){e.drawImage(this.image,this.x-t,this.y-a,this.image.width,this.image.height)}}t.default=i},386:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=a(307),i=a(808);class s extends i.default{constructor(){super(),this._isMain=!0,this._isPrey=!1,this._isObstacle=!1,this._imageFilename="turtle.png",this.resetPosition(),this._angle=n.default.right,this._bgStartX=0,this._bgStartY=0,this.resetFoodValue(),this.resetLifeValue()}resetPosition(){this._x=50,this._y=10}resetFoodValue(){this._foodValue=100}resetLifeValue(){this._lifeValue=100}increaseFoodValue(e){this._foodValue+=e}decreaseFoodValue(){this._foodValue-=.01}applyDamage(e){this._lifeValue-=e}get lifeValue(){return this._lifeValue}set bgStartX(e){this._bgStartX=e}set bgStartY(e){this._bgStartY=e}set limitY(e){this._limitY=e}moveUp(){this._y>0&&(this._y-=s._step)}moveDown(){this._y<this._limitY&&(this._y+=s._step)}moveLeft(){this.rotate(n.default.left),this._x>0&&(this._x-=s._step)}moveRight(){this.rotate(n.default.right),this._x+=s._step}rotate(e){this._angle=e}applyRotation(e){e.translate(this._x,this._y),e.rotate(this._angle),e.translate(-this._x,-this._y)}paint(e){this.applyRotation(e),e.drawImage(this._image,this._x-this._bgStartX,this._y-this._bgStartY,this._image.width,this._image.height),e.resetTransform()}}s.scientificName="Carretta carretta",s._step=3,t.default=s},307:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});const a={right:0,left:Math.PI};t.default=a},417:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=a(691),i=a(903),s=a(525);t.default=function(e){const{canvas:t,mainCharacter:a,upBtnId:o,leftBtnId:l,rightBtnId:d,downBtnId:r}=e;(0,n.default)(t,a),(0,s.default)(t,a),(0,i.default)(a,{upBtnId:o,leftBtnId:l,rightBtnId:d,downBtnId:r})}},691:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){e.addEventListener("keydown",(e=>function(e,t){["w","W","ArrowUp"].includes(e.key)&&t.moveUp(),["s","S","ArrowDown"].includes(e.key)&&t.moveDown(),["a","A","ArrowLeft"].includes(e.key)&&t.moveLeft(),["d","D","ArrowRight"].includes(e.key)&&t.moveRight()}(e,t)))}},903:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});let a=0;function n(e,t){t(),a=requestAnimationFrame((()=>n(e,t)))}function i(){cancelAnimationFrame(a)}function s(e,t,a){t.addEventListener("mousedown",(()=>n(e,a))),t.addEventListener("mouseup",i),t.addEventListener("mouseleave",i),t.addEventListener("touchstart",(()=>n(e,a))),t.addEventListener("touchend",i)}t.default=function(e,t){const a=document.getElementById(t.upBtnId),n=document.getElementById(t.leftBtnId),i=document.getElementById(t.rightBtnId),o=document.getElementById(t.downBtnId);s(e,a,(()=>e.moveUp())),s(e,n,(()=>e.moveLeft())),s(e,i,(()=>e.moveRight())),s(e,o,(()=>e.moveDown()))}},525:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){e.addEventListener("wheel",(e=>function(e,t){e.preventDefault(),e.deltaX<0&&t.moveLeft(),e.deltaX>0&&t.moveRight(),e.deltaY<0&&t.moveUp(),e.deltaY>0&&t.moveDown()}(e,t)))}},212:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=a(487);class i{static modal(e,t){if(!document.getElementById(t.id)){const a=document.createElement("div");if(a.tabIndex=1,a.id=t.id,a.classList.add("dialog","fixed","text-white","w-4/5","opacity-80","focus:opacity-95","bg-amber-500","dark:bg-gray-900","pt-5","pb-5","rounded-3xl","max-w-xl"),t.title){const e=document.createElement("h1");e.innerText=t.title,e.classList.add("text-center","text-xl"),a.appendChild(e),a.appendChild(document.createElement("hr"))}const i=document.createElement("div");switch(this.appendText(t.text,i),a.appendChild(i),e){case n.DialogType.Confirmation:{const e=t,n=document.createElement("div");n.classList.add("w-fit","m-auto"),a.appendChild(n),this.appendBtn(n,"Yes",(()=>{e.yesCallback(),this.closeModal(a)}),!1,"button"),this.appendBtn(n,"No",(()=>{e.noCallback(),this.closeModal(a)}),!0,"button");break}case n.DialogType.Notification:this.appendOKButton(a),this.listenKeyboard(a);break;case n.DialogType.Prompt:{const e=t;this.appendForm(a,e);break}case n.DialogType.Credits:{const e=t;this.appendCredits(i,e),this.appendOKButton(a),this.listenKeyboard(a);break}case n.DialogType.Menu:{const e=t;this.appendMenu(a,e),this.appendOKButton(a),this.listenKeyboard(a);break}case n.DialogType.Changelog:{const e=t;this.appendChangelog(a,e),this.appendOKButton(a),this.listenKeyboard(a);break}}document.body.appendChild(a)}}static appendBtn(e,t,a,n,i){const s=document.createElement("button");s.type=i,s.classList.add("rounded-3xl","m-1","cursor-pointer"),this.assignButtonColor(s,n);const o=document.createElement("span");o.classList.add("text-xl","ml-2","mr-2"),o.innerText=t,s.appendChild(o),"button"===i&&s.addEventListener("click",a),e.appendChild(s)}static appendForm(e,t){const a=document.createElement("div");a.classList.add("m-auto","w-3/4"),e.appendChild(a);const n=document.createElement("form");a.appendChild(n),n.addEventListener("submit",(a=>{a.preventDefault(),t.onOK&&t.onOK(),this.closeModal(e)})),this.appendInputs(n,t.inputs),this.appendSelects(n,t.selects);const i=document.createElement("div");i.classList.add("w-fit","m-auto"),n.appendChild(i),this.appendBtn(i,"OK",null,!1,"submit"),this.appendBtn(i,"Cancel",(()=>{t.onCancel&&t.onCancel(),this.closeModal(e)}),!0,"button")}static appendInputs(e,t){for(const a of t){const t=document.createElement("input");t.type=a.type,t.id=`dialog-input-${a.name}`,t.name=`dialog-input-${a.name}`,t.ariaPlaceholder=`Enter ${a.label}`,t.placeholder=`Enter ${a.label}`,t.maxLength=a.limit,this.assignInputClassNames(t),t.required=a.required,t.ariaRequired=a.required.toString(),e.appendChild(t),this.appendBrElement(e),this.appendBrElement(e)}}static assignInputClassNames(e){e.classList.add("text-center","w-full","rounded-3xl","h-9","text-lg","text-gray-700")}static appendSelects(e,t){for(const a of t){const t=document.createElement("select");t.id=`dialog-select-${a.name}`,t.name=`dialog-select-${a.name}`,t.ariaPlaceholder=a.label,this.assignInputClassNames(t),t.required=a.required,t.ariaRequired=a.required.toString(),e.appendChild(t);for(const e of a.options){const n=document.createElement("option");n.innerText=e.text,n.value=e.value,a.default===parseInt(e.value)&&(n.selected=!0,n.ariaSelected="true"),t.appendChild(n)}const n=a.onChange;n&&(n(t.selectedOptions[0].value),t.addEventListener("change",(()=>n(t.selectedOptions[0].value)))),this.appendBrElement(e),this.appendBrElement(e)}}static appendBrElement(e){const t=document.createElement("br");e.appendChild(t)}static appendText(e,t){if(this.assignTextClassNames(t),e)for(const a of e){const e=document.createElement("p");e.innerText=a,t.appendChild(e)}}static appendCredits(e,t){for(const a of t.sections){const t=document.createElement("h2");t.classList.add("text-xl"),t.innerText=a.title,e.appendChild(t);const n=document.createElement("ul");n.classList.add("ml-5");for(const e of a.contributors){const t=document.createElement("li");t.innerText=e,n.appendChild(t)}e.appendChild(n)}}static appendOKButton(e){const t=document.createElement("div");t.classList.add("w-fit","m-auto"),e.appendChild(t),this.appendBtn(t,"OK",(()=>this.closeModal(e)),!1,"button")}static listenKeyboard(e){e.addEventListener("keydown",(t=>{"Escape"!==t.key&&"Enter"!==t.key||this.closeModal(e)}))}static appendMenu(e,t){const a=document.createElement("div");a.classList.add("w-1/3","m-auto"),e.appendChild(a);for(const e of t.buttons){const t=document.createElement("button");t.type="button",t.innerText=e.text,t.classList.add("w-full","h-12","rounded-3xl","mt-3","mb-3"),this.assignButtonColor(t,e.isDanger),t.addEventListener("click",e.callback),a.appendChild(t)}}static appendChangelog(e,t){const a=document.createElement("div");this.assignTextClassNames(a),e.appendChild(a);for(const e of t.releases){const t=document.createElement("h2");t.classList.add("text-xl"),t.innerText=`${e.version} (${e.status} release - ${e.dateTime})`,a.appendChild(t);const n=document.createElement("ul");n.classList.add("ml-5"),a.appendChild(n);for(const t of e.points){const e=document.createElement("li");if(e.innerText=t.text,n.appendChild(e),t.subPoints&&t.subPoints.length>0){const a=document.createElement("ol");a.classList.add("list-decimal","ml-5"),e.appendChild(a);for(const e of t.subPoints){const t=document.createElement("li");t.innerText=e,a.appendChild(t)}}}}}static assignTextClassNames(e){e.classList.add("w-11/12","m-auto","mt-3","mb-3","grid","gap-3","max-h-screen-1/4","overflow-y-auto")}static assignButtonColor(e,t){t?e.classList.add("bg-red-600"):e.classList.add("bg-theme-color","dark:bg-dark-theme-color")}static closeModal(e){document.body.contains(e)&&document.body.removeChild(e)}static closeAllOpenDialogs(){const e=document.getElementsByClassName("dialog");for(let t=0;t<e.length;t++)this.closeModal(e[t])}}i.confirm=e=>i.modal(n.DialogType.Confirmation,e),i.notify=e=>i.modal(n.DialogType.Notification,e),i.prompt=e=>i.modal(n.DialogType.Prompt,e),i.credit=e=>i.modal(n.DialogType.Credits,e),i.menu=e=>i.modal(n.DialogType.Menu,e),i.changelog=e=>i.modal(n.DialogType.Changelog,e),t.default=i},487:(e,t)=>{var a;Object.defineProperty(t,"__esModule",{value:!0}),t.DialogType=void 0,function(e){e[e.Confirmation=0]="Confirmation",e[e.Notification=1]="Notification",e[e.Prompt=2]="Prompt",e[e.Credits=3]="Credits",e[e.Menu=4]="Menu",e[e.Changelog=5]="Changelog"}(a||(t.DialogType=a={}))},11:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=a(10);t.default=function(e){if(e<=n.default.length)return n.default[e-1];throw new Error(`Level ${e} not implemented`)}},721:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{async init(){try{return await this.loadBgImg(),await this.loadCharacters(),this.setInitialCharacterPositions(),this._backgroundImage}catch(e){throw e}}loadBgImg(){return new Promise(((e,t)=>{const a=document.createElement("img");a.src=this._backgroundImagePath,a.onload=()=>{this._backgroundImage=a,e(a)},a.onerror=()=>t(new Error("Could not load level background"))}))}set bgOffsetX(e){this._bgOffsetX=e}set bgOffsetY(e){this._bgOffsetY=e}get bgImgPath(){return this._backgroundImagePath}get bgImg(){return this._backgroundImage}get characters(){return this._characters}setInitialCharacterPositions(){for(const e of this._characters)e.x=Math.random()*this._backgroundImage.width,e.y=Math.random()*this._backgroundImage.height}async loadCharacters(){for(const e of this.characters)await e.loadImage()}paintCharacters(e){try{for(const t of this.characters)t.paint(e,this._bgOffsetX,this._bgOffsetY)}catch(e){throw e}}}},630:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=a(482),i=a(873),s=a(721);class o extends s.default{constructor(){super(...arguments),this._backgroundImagePath="./images/bg-lvl1.png",this._characters=new Set([new n.default,new n.default,new n.default,new n.default,new n.default,new n.default,new n.default,new i.default,new i.default])}}t.default=o},809:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=a(721);class i extends n.default{constructor(){super(...arguments),this._backgroundImagePath="./images/bg-demo-black.png",this._characters=new Set([])}}t.default=i},10:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LevelChangeTypes=void 0;const n=a(630),i=a(809);var s;!function(e){e[e.GameOver=0]="GameOver",e[e.NewLevel=1]="NewLevel",e[e.SameLevel=2]="SameLevel",e[e.GameComplete=3]="GameComplete"}(s||(t.LevelChangeTypes=s={}));const o=[new n.default,new i.default];t.default=o},962:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=a(212),i=a(10);function s(e,t){const a=e.x,n=a+e.image.width,i=e.y,s=i+e.image.height;return console.log(`Other character: ${t.x}, ${t.y}`),a<=t.x&&t.x<=n&&i<=t.y&&t.y<=s}t.default=function(e,t){return e.decreaseFoodValue(),e.foodValue<=0?{levelChangeType:i.LevelChangeTypes.GameOver}:e.x>=t.bgWidth?function(e,t){return t.levelNo++,e.resetPosition(),t.levelNo<=i.default.length?(n.default.notify({id:"new-level",title:"New Level",text:[`Welcome to level ${t.levelNo}`]}),{levelChangeType:i.LevelChangeTypes.NewLevel,newLevel:t.levelNo}):{levelChangeType:i.LevelChangeTypes.GameComplete}}(e,t):(function(e,t){for(const a of t.characters)s(e,a)&&a.isPrey&&(e.increaseFoodValue(a.foodValue),t.characters.delete(a))}(e,t.level),{levelChangeType:i.LevelChangeTypes.SameLevel})}},147:e=>{e.exports=JSON.parse('{"version":"0.1.2 Preview","devDependencies":{"concurrently":"^8.2.2","postcss":"^8.4.33","serve":"^14.2.1","tailwindcss":"^3.4.1","ts-loader":"^9.5.1","typescript":"^5.3.3","webpack":"^5.89.0","webpack-cli":"^5.1.4"},"scripts":{"webpack":"npx webpack --watch","serve":"npx serve -l 5000","tailwind":"npx tailwindcss -i ./src/main.css -o ./dist/bundle.css --watch --minify","dev":"npx concurrently \\"npm run webpack\\" \\"npm run serve\\" \\"npm run tailwind\\"","start":"npm run dev"}}')}},t={};function a(n){var i=t[n];if(void 0!==i)return i.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,a),s.exports}(()=>{const e=a(386),t=a(147),n=a(417),i=a(962),s=a(11),o=a(212),l=a(136),d=a(630),r=a(10);(async()=>{const a=document.getElementById("canvas"),c=a.getContext("2d"),u=new e.default;await u.loadImage();let h=1;(0,n.default)({canvas:a,mainCharacter:u,upBtnId:"upBtn",leftBtnId:"leftBtn",rightBtnId:"rightBtn",downBtnId:"downBtn"});let m=new d.default,p=await g();async function g(){try{const e=await m.init();return u.limitY=e.height,e}catch(e){o.default.notify({id:"game-error",title:"Error",text:[e]})}}function f(){a.height=window.innerHeight,a.width=window.innerWidth,l.default.readjustCanvasForBg(a,p)}l.default.readjustCanvasForBg(a,p),window.addEventListener("resize",f),f(),document.getElementById("version").innerText=t.version,a.focus(),await async function e(){try{const{levelChangeType:t,newLevel:n}=(0,i.default)(u,{bgWidth:p.width,levelNo:h,level:m});t===r.LevelChangeTypes.SameLevel||t===r.LevelChangeTypes.NewLevel?(t===r.LevelChangeTypes.NewLevel&&(h=n,m=(0,s.default)(h),p=await g()),l.default.paint(p,{canvas:a,context:c,mainCharacter:u,level:m}),u.paint(c),m.paintCharacters(c),document.getElementById("foodMeter").value=u.foodValue,document.getElementById("lifeMeter").value=u.lifeValue,requestAnimationFrame(e)):t===r.LevelChangeTypes.GameComplete?o.default.notify({id:"game-over-dialog",title:"Game complete",text:["Game complete. Congratulations!"]}):o.default.notify({id:"game-over-dialog",title:"You lose",text:["Better luck next time!"]})}catch(e){o.default.notify({id:"game-error",title:"Error",text:[e]})}}(),o.default.notify({id:"dialog-game-welcome",title:"Welcome",text:["Welcome to Turtle Escape!"]})})()})()})();
//# sourceMappingURL=bundle.js.map