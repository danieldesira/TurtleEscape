(()=>{"use strict";var e={136:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});class a{static paint(e,t){const n=a.calculateScreenCutOffPoints(e.width,t.canvas.width),i=a.calculateScreenCutOffPoints(e.height,t.canvas.height),s=t.mainCharacter.x<t.canvas.width?0:n[Math.floor(e.width/t.mainCharacter.x)-1],o=t.mainCharacter.y<t.canvas.height?0:i[Math.floor(e.height/t.mainCharacter.y)-1];t.context.drawImage(e,s,o,t.canvas.width,t.canvas.height,0,0,t.canvas.width,t.canvas.height),a.updateBgRelatedProperties(t,s,o)}static calculateScreenCutOffPoints(e,t){const a=[],n=Math.floor(e/t);for(let e=1;e<n;e++)a.push(e*t);return a.push(e-n*t),a}static readjustCanvasForBg(e,t){t.height<e.height&&(e.height=t.height),t.width<e.width&&(e.width=t.width)}static updateBgRelatedProperties(e,t,a){e.mainCharacter.bgStartX=t,e.mainCharacter.bgStartY=a,e.level.bgOffsetX=t,e.level.bgOffsetY=a}}t.default=a},808:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this._baseImagePath="./images/characters/"}loadImage(){return new Promise(((e,t)=>{const a=document.createElement("img");a.src=this._baseImagePath+this._imageFilename,a.onload=()=>{this._image=a,e(a)},a.onerror=()=>t(new Error(`Failed to load character image: ${this._imageFilename}`))}))}paint(e,t=0,a=0){e.drawImage(this.image,this.x-t,this.y-a,this.image.width,this.image.height)}get x(){return this._x}get y(){return this._y}set x(e){this._x=e}set y(e){this._y=e}get isMain(){return this._isMain}get isPrey(){return this._isPrey}get isObstacle(){return this._isObstacle}get isBenthic(){return this._isBenthic}get foodValue(){return this._foodValue}get damage(){return this._damage}get image(){return this._image}}},158:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(a(808));class s extends i.default{constructor(){super(...arguments),this._isMain=!1,this._isPrey=!0,this._isObstacle=!1,this._isBenthic=!0,this._imageFilename="neptune-grass.png",this._foodValue=5,this._damage=0}}t.default=s},944:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(a(808));class s extends i.default{constructor(){super(...arguments),this._isMain=!1,this._isPrey=!1,this._isObstacle=!0,this._isBenthic=!1,this._imageFilename="plastic-bag.png",this._foodValue=0,this._damage=8}}t.default=s},482:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(a(808));class s extends i.default{constructor(){super(...arguments),this._isMain=!1,this._isPrey=!0,this._isObstacle=!1,this._isBenthic=!1,this._imageFilename="shrimp.png",this._foodValue=.01}}t.default=s},873:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(a(808));class s extends i.default{constructor(){super(...arguments),this._isMain=!1,this._isPrey=!0,this._isObstacle=!1,this._isBenthic=!1,this._imageFilename="small-fish.png",this._foodValue=.6}}t.default=s},386:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(a(307)),s=n(a(808));class o extends s.default{constructor(){super(),this._isMain=!0,this._isPrey=!1,this._isObstacle=!1,this._imageFilename="turtle.png",this.resetPosition(),this._angle=i.default.right,this._bgStartX=0,this._bgStartY=0,this.resetFoodValue(),this.resetLifeValue(),this._oxygenValue=100}resetPosition(){this._x=50,this._y=10}resetFoodValue(){this._foodValue=100}resetLifeValue(){this._lifeValue=100}increaseFoodValue(e){this._foodValue+=e}decreaseFoodValue(){this._foodValue-=.01}breath(){this._oxygenValue+=.5}useOxygen(){this._oxygenValue-=.001}applyDamage(e){this._lifeValue-=e}get lifeValue(){return this._lifeValue}get oxygenValue(){return this._oxygenValue}set bgStartX(e){this._bgStartX=e}set bgStartY(e){this._bgStartY=e}set limitY(e){this._limitY=e}moveUp(){this._y>0&&(this._y-=o._step)}moveDown(){this._y<this._limitY&&(this._y+=o._step)}moveLeft(){this.rotate(i.default.left),this._x>0&&(this._x-=o._step)}moveRight(){this.rotate(i.default.right),this._x+=o._step}rotate(e){this._angle=e}applyRotation(e){e.translate(this._x,this._y),e.rotate(this._angle),e.translate(-this._x,-this._y)}paint(e){this.applyRotation(e),e.drawImage(this._image,this._x-this._bgStartX,this._y-this._bgStartY,this._image.width,this._image.height),e.resetTransform()}}o.scientificName="Carretta carretta",o._step=3,t.default=o},307:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});const a={right:0,left:Math.PI};t.default=a},417:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(a(691)),s=n(a(903)),o=n(a(525));t.default=function(e){const{canvas:t,mainCharacter:a,upBtnId:n,leftBtnId:l,rightBtnId:r,downBtnId:d}=e;(0,i.default)(t,a),(0,o.default)(t,a),(0,s.default)(a,{upBtnId:n,leftBtnId:l,rightBtnId:r,downBtnId:d})}},691:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){e.addEventListener("keydown",(e=>function(e,t){["w","W","ArrowUp"].includes(e.key)&&t.moveUp(),["s","S","ArrowDown"].includes(e.key)&&t.moveDown(),["a","A","ArrowLeft"].includes(e.key)&&t.moveLeft(),["d","D","ArrowRight"].includes(e.key)&&t.moveRight()}(e,t)))}},903:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});let a=0;function n(e,t){t(),a=requestAnimationFrame((()=>n(e,t)))}function i(){cancelAnimationFrame(a)}function s(e,t,a){t.addEventListener("mousedown",(()=>n(e,a))),t.addEventListener("mouseup",i),t.addEventListener("mouseleave",i),t.addEventListener("touchstart",(()=>n(e,a))),t.addEventListener("touchend",i)}t.default=function(e,t){const a=document.getElementById(t.upBtnId),n=document.getElementById(t.leftBtnId),i=document.getElementById(t.rightBtnId),o=document.getElementById(t.downBtnId);s(e,a,(()=>e.moveUp())),s(e,n,(()=>e.moveLeft())),s(e,i,(()=>e.moveRight())),s(e,o,(()=>e.moveDown()))}},525:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){e.addEventListener("wheel",(e=>function(e,t){e.preventDefault(),e.deltaX<0&&t.moveLeft(),e.deltaX>0&&t.moveRight(),e.deltaY<0&&t.moveUp(),e.deltaY>0&&t.moveDown()}(e,t)))}},212:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const n=a(487);class i{static modal(e,t){if(!document.getElementById(t.id)){const a=document.createElement("div");if(a.tabIndex=1,a.id=t.id,a.classList.add("dialog","fixed","text-white","w-4/5","opacity-80","focus:opacity-95","bg-amber-500","dark:bg-gray-900","pt-5","pb-5","rounded-3xl","max-w-xl"),t.title){const e=document.createElement("h1");e.innerText=t.title,e.classList.add("text-center","text-xl"),a.appendChild(e),a.appendChild(document.createElement("hr"))}const i=document.createElement("div");switch(this.appendText(t.text,i),a.appendChild(i),e){case n.DialogType.Confirmation:{const e=t,n=document.createElement("div");n.classList.add("w-fit","m-auto"),a.appendChild(n),this.appendBtn(n,"Yes",(()=>{e.yesCallback(),this.closeModal(a)}),!1,"button"),this.appendBtn(n,"No",(()=>{e.noCallback(),this.closeModal(a)}),!0,"button");break}case n.DialogType.Notification:this.appendOKButton(a),this.listenKeyboard(a);break;case n.DialogType.Prompt:{const e=t;this.appendForm(a,e);break}case n.DialogType.Credits:{const e=t;this.appendCredits(i,e),this.appendOKButton(a),this.listenKeyboard(a);break}case n.DialogType.Menu:{const e=t;this.appendMenu(a,e),this.appendOKButton(a),this.listenKeyboard(a);break}case n.DialogType.Changelog:{const e=t;this.appendChangelog(a,e),this.appendOKButton(a),this.listenKeyboard(a);break}}document.body.appendChild(a)}}static appendBtn(e,t,a,n,i){const s=document.createElement("button");s.type=i,s.classList.add("rounded-3xl","m-1","cursor-pointer"),this.assignButtonColor(s,n);const o=document.createElement("span");o.classList.add("text-xl","ml-2","mr-2"),o.innerText=t,s.appendChild(o),"button"===i&&s.addEventListener("click",a),e.appendChild(s)}static appendForm(e,t){const a=document.createElement("div");a.classList.add("m-auto","w-3/4"),e.appendChild(a);const n=document.createElement("form");a.appendChild(n),n.addEventListener("submit",(a=>{a.preventDefault(),t.onOK&&t.onOK(),this.closeModal(e)})),this.appendInputs(n,t.inputs),this.appendSelects(n,t.selects);const i=document.createElement("div");i.classList.add("w-fit","m-auto"),n.appendChild(i),this.appendBtn(i,"OK",null,!1,"submit"),this.appendBtn(i,"Cancel",(()=>{t.onCancel&&t.onCancel(),this.closeModal(e)}),!0,"button")}static appendInputs(e,t){for(const a of t){const t=document.createElement("input");t.type=a.type,t.id=`dialog-input-${a.name}`,t.name=`dialog-input-${a.name}`,t.ariaPlaceholder=`Enter ${a.label}`,t.placeholder=`Enter ${a.label}`,t.maxLength=a.limit,this.assignInputClassNames(t),t.required=a.required,t.ariaRequired=a.required.toString(),e.appendChild(t),this.appendBrElement(e),this.appendBrElement(e)}}static assignInputClassNames(e){e.classList.add("text-center","w-full","rounded-3xl","h-9","text-lg","text-gray-700")}static appendSelects(e,t){for(const a of t){const t=document.createElement("select");t.id=`dialog-select-${a.name}`,t.name=`dialog-select-${a.name}`,t.ariaPlaceholder=a.label,this.assignInputClassNames(t),t.required=a.required,t.ariaRequired=a.required.toString(),e.appendChild(t);for(const e of a.options){const n=document.createElement("option");n.innerText=e.text,n.value=e.value,a.default===parseInt(e.value)&&(n.selected=!0,n.ariaSelected="true"),t.appendChild(n)}const n=a.onChange;n&&(n(t.selectedOptions[0].value),t.addEventListener("change",(()=>n(t.selectedOptions[0].value)))),this.appendBrElement(e),this.appendBrElement(e)}}static appendBrElement(e){const t=document.createElement("br");e.appendChild(t)}static appendText(e,t){if(this.assignTextClassNames(t),e)for(const a of e){const e=document.createElement("p");e.innerText=a,t.appendChild(e)}}static appendCredits(e,t){for(const a of t.sections){const t=document.createElement("h2");t.classList.add("text-xl"),t.innerText=a.title,e.appendChild(t);const n=document.createElement("ul");n.classList.add("ml-5");for(const e of a.contributors){const t=document.createElement("li");t.innerText=e,n.appendChild(t)}e.appendChild(n)}}static appendOKButton(e){const t=document.createElement("div");t.classList.add("w-fit","m-auto"),e.appendChild(t),this.appendBtn(t,"OK",(()=>this.closeModal(e)),!1,"button")}static listenKeyboard(e){e.addEventListener("keydown",(t=>{"Escape"!==t.key&&"Enter"!==t.key||this.closeModal(e)}))}static appendMenu(e,t){const a=document.createElement("div");a.classList.add("w-1/3","m-auto"),e.appendChild(a);for(const e of t.buttons){const t=document.createElement("button");t.type="button",t.innerText=e.text,t.classList.add("w-full","h-12","rounded-3xl","mt-3","mb-3"),this.assignButtonColor(t,e.isDanger),t.addEventListener("click",e.callback),a.appendChild(t)}}static appendChangelog(e,t){const a=document.createElement("div");this.assignTextClassNames(a),e.appendChild(a);for(const e of t.releases){const t=document.createElement("h2");t.classList.add("text-xl"),t.innerText=`${e.version} (${e.status} release - ${e.dateTime})`,a.appendChild(t);const n=document.createElement("ul");n.classList.add("ml-5"),a.appendChild(n);for(const t of e.points){const e=document.createElement("li");if(e.innerText=t.text,n.appendChild(e),t.subPoints&&t.subPoints.length>0){const a=document.createElement("ol");a.classList.add("list-decimal","ml-5"),e.appendChild(a);for(const e of t.subPoints){const t=document.createElement("li");t.innerText=e,a.appendChild(t)}}}}}static assignTextClassNames(e){e.classList.add("w-11/12","m-auto","mt-3","mb-3","grid","gap-3","max-h-screen-1/4","overflow-y-auto")}static assignButtonColor(e,t){t?e.classList.add("bg-red-600"):e.classList.add("bg-theme-color","dark:bg-dark-theme-color")}static closeModal(e){document.body.contains(e)&&document.body.removeChild(e)}static closeAllOpenDialogs(){const e=document.getElementsByClassName("dialog");for(let t=0;t<e.length;t++)this.closeModal(e[t])}}i.confirm=e=>i.modal(n.DialogType.Confirmation,e),i.notify=e=>i.modal(n.DialogType.Notification,e),i.prompt=e=>i.modal(n.DialogType.Prompt,e),i.credit=e=>i.modal(n.DialogType.Credits,e),i.menu=e=>i.modal(n.DialogType.Menu,e),i.changelog=e=>i.modal(n.DialogType.Changelog,e),t.default=i},487:(e,t)=>{var a;Object.defineProperty(t,"__esModule",{value:!0}),t.DialogType=void 0,function(e){e[e.Confirmation=0]="Confirmation",e[e.Notification=1]="Notification",e[e.Prompt=2]="Prompt",e[e.Credits=3]="Credits",e[e.Menu=4]="Menu",e[e.Changelog=5]="Changelog"}(a||(t.DialogType=a={}))},11:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(a(10));t.default=function(e){if(e<=i.default.length)return i.default[e-1];throw new Error(`Level ${e} not implemented`)}},721:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{constructor(){this._backgroundImagePath="./images/backgrounds/"}async init(){try{return await this.loadBgImg(),await this.loadCharacters(),this.setInitialCharacterPositions(),this._backgroundImage}catch(e){throw e}}loadBgImg(){return new Promise(((e,t)=>{const a=document.createElement("img");a.src=this._backgroundImagePath+this._backgroundImageFilename,a.onload=()=>{this._backgroundImage=a,e(a)},a.onerror=()=>t(new Error("Could not load level background"))}))}set bgOffsetX(e){this._bgOffsetX=e}set bgOffsetY(e){this._bgOffsetY=e}get bgImgPath(){return this._backgroundImagePath}get bgImg(){return this._backgroundImage}get characters(){return this._characters}setInitialCharacterPositions(){for(const e of this._characters)e.x=Math.random()*this._backgroundImage.width,e.isBenthic?e.y=Math.random()*(this._backgroundImage.height-this._benthicOffsetY)+this._benthicOffsetY:e.y=Math.random()*this._backgroundImage.height}async loadCharacters(){for(const e of this.characters)await e.loadImage()}paintCharacters(e){try{for(const t of this.characters)t.paint(e,this._bgOffsetX,this._bgOffsetY)}catch(e){throw e}}}},630:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(a(944)),s=n(a(482)),o=n(a(873)),l=n(a(721));class r extends l.default{constructor(){super(...arguments),this._backgroundImageFilename="bg-lvl1.png",this._characters=new Set([new s.default,new s.default,new s.default,new s.default,new s.default,new s.default,new s.default,new o.default,new o.default,new i.default,new i.default,new i.default,new i.default]),this._benthicOffsetY=9999}}t.default=r},809:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(a(158)),s=n(a(944)),o=n(a(721));class l extends o.default{constructor(){super(...arguments),this._backgroundImageFilename="bg-demo-black.png",this._characters=new Set([new s.default,new s.default,new s.default,new s.default,new s.default,new s.default,new i.default,new i.default,new i.default,new i.default]),this._benthicOffsetY=600}}t.default=l},10:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.LevelChangeTypes=void 0;const i=n(a(630)),s=n(a(809));var o;!function(e){e[e.GameOver=0]="GameOver",e[e.NewLevel=1]="NewLevel",e[e.SameLevel=2]="SameLevel",e[e.GameComplete=3]="GameComplete"}(o||(t.LevelChangeTypes=o={}));const l=[new i.default,new s.default];t.default=l},519:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(a(386)),s=a(147),o=n(a(417)),l=n(a(962)),r=n(a(11)),d=n(a(212)),c=n(a(136)),u=n(a(630)),h=a(10);(async()=>{const e=document.getElementById("canvas"),t=e.getContext("2d"),a=new i.default;await a.loadImage();let n=1;(0,o.default)({canvas:e,mainCharacter:a,upBtnId:"upBtn",leftBtnId:"leftBtn",rightBtnId:"rightBtn",downBtnId:"downBtn"});let f=new u.default,m=await p();async function p(){try{const e=await f.init();return a.limitY=e.height,e}catch(e){d.default.notify({id:"game-error",title:"Error",text:[e]})}}function g(){e.height=window.innerHeight,e.width=window.innerWidth,c.default.readjustCanvasForBg(e,m)}c.default.readjustCanvasForBg(e,m),window.addEventListener("resize",g),g(),document.getElementById("version").innerText=s.version,e.focus(),await async function i(){try{const{levelChangeType:s,newLevel:o}=(0,l.default)(a,{bgWidth:m.width,levelNo:n,level:f});s===h.LevelChangeTypes.SameLevel||s===h.LevelChangeTypes.NewLevel?(s===h.LevelChangeTypes.NewLevel&&(n=o,f=(0,r.default)(n),m=await p()),c.default.paint(m,{canvas:e,context:t,mainCharacter:a,level:f}),a.paint(t),f.paintCharacters(t),document.getElementById("foodMeter").value=a.foodValue,document.getElementById("lifeMeter").value=a.lifeValue,document.getElementById("oxygenMeter").value=a.oxygenValue,requestAnimationFrame(i)):s===h.LevelChangeTypes.GameComplete?d.default.notify({id:"game-over-dialog",title:"Game complete",text:["Game complete. Congratulations!"]}):d.default.notify({id:"game-over-dialog",title:"You lose",text:["Better luck next time!"]})}catch(e){d.default.notify({id:"game-error",title:"Error",text:[e]})}}(),d.default.notify({id:"dialog-game-welcome",title:"Welcome",text:["Welcome to Turtle Escape!"]})})()},962:function(e,t,a){var n=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var i=Object.getOwnPropertyDescriptor(t,a);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,i)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&n(t,e,a);return i(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=o(a(212)),r=s(a(10));function d(e,t){const a=e.x+e.image.width,n=e.y+e.image.height;return e.x<=t.x&&t.x<=a&&e.y<=t.y&&t.y<=n}t.default=function(e,t){return e.decreaseFoodValue(),e.foodValue<=0||e.oxygenValue<=0||e.lifeValue<=0?{levelChangeType:r.LevelChangeTypes.GameOver}:(e.y<=0?e.breath():e.useOxygen(),e.x>=t.bgWidth?function(e,t){return t.levelNo++,e.resetPosition(),t.levelNo<=r.default.length?(l.default.notify({id:"new-level",title:"New Level",text:[`Welcome to level ${t.levelNo}`]}),{levelChangeType:r.LevelChangeTypes.NewLevel,newLevel:t.levelNo}):{levelChangeType:r.LevelChangeTypes.GameComplete}}(e,t):(function(e,t){for(const a of t.characters)d(e,a)&&(a.isPrey?(e.increaseFoodValue(a.foodValue),t.characters.delete(a)):a.isObstacle&&(e.applyDamage(a.damage),t.characters.delete(a)))}(e,t.level),{levelChangeType:r.LevelChangeTypes.SameLevel}))}},147:e=>{e.exports=JSON.parse('{"version":"0.2.0","devDependencies":{"concurrently":"^8.2.2","postcss":"^8.4.33","serve":"^14.2.1","tailwindcss":"^3.4.1","ts-loader":"^9.5.1","typescript":"^5.3.3","webpack":"^5.89.0","webpack-cli":"^5.1.4"},"scripts":{"webpack":"npx webpack --watch","serve":"npx serve -l 5000","tailwind":"npx tailwindcss -i ./src/main.css -o ./dist/bundle.css --watch --minify","dev":"npx concurrently \\"npm run webpack\\" \\"npm run serve\\" \\"npm run tailwind\\"","start":"npm run dev"}}')}},t={};!function a(n){var i=t[n];if(void 0!==i)return i.exports;var s=t[n]={exports:{}};return e[n].call(s.exports,s,s.exports,a),s.exports}(519)})();
//# sourceMappingURL=bundle.js.map